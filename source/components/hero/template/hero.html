{% from 'video.html' import video  %}
{% from 'button.html' import button %}
{% from 'modal.html' import modal %}
{% import 'form-elements.html' as form %}
{% from 'toast.html' import toast %}


<div class="c-hero">
    {{ video({
      instance_id: 1,
      id: '1',
      platform: 'native',
      title: 'Dept agency Introduction',
      description: 'Introduction Video',
      thumbnail: 'https://www.deptagency.com/wp-content/uploads/fly-images/114213/Dept_Berlin_Office-19-1280x720-c.jpg',
      controls: 0,
      playsinline: 1,
      autoplay: 1,
      loop: 1,
      muted: 1,
      image: {
          preload: 'https://www.deptagency.com/wp-content/uploads/fly-images/114213/Dept_Berlin_Office-19-480x250-c.jpg',
          image: 'https://www.deptagency.com/wp-content/uploads/fly-images/114213/Dept_Berlin_Office-19-1280x720-c.jpg',
          srcset: 'https://www.deptagency.com/wp-content/uploads/fly-images/114213/Dept_Berlin_Office-19-320x250-c.jpg 320w,https://www.deptagency.com/wp-content/uploads/fly-images/114213/Dept_Berlin_Office-19-480x250-c.jpg 480w,https://www.deptagency.com/wp-content/uploads/fly-images/114213/Dept_Berlin_Office-19-730x410-c.jpg 1024w,https://www.deptagency.com/wp-content/uploads/fly-images/114213/Dept_Berlin_Office-19-1024x576-c.jpg 1024w,https://www.deptagency.com/wp-content/uploads/fly-images/114213/Dept_Berlin_Office-19-1280x720-c.jpg 1280w,https://www.deptagency.com/wp-content/uploads/fly-images/114213/Dept_Berlin_Office-19-1440x810-c.jpg 1440w'
      },
      sources: [
          {
              size : 1920,
              source: [
                  {
                      url: 'https://player.vimeo.com/external/344108443.hd.mp4?s=c1730857e5c3097471ce4d0e05b3bfd287ab561f&profile_id=175',
                      type: 'video/mp4'
                  }
              ]
          },
          {
              size : 1280,
              source: [
                  {
                      url: 'https://player.vimeo.com/external/344108443.hd.mp4?s=c1730857e5c3097471ce4d0e05b3bfd287ab561f&profile_id=175',
                      type: 'video/mp4'
                  }
              ]
          },
          {
              size : 1024,
              source: [
                  {
                      url: 'https://player.vimeo.com/external/344108443.hd.mp4?s=c1730857e5c3097471ce4d0e05b3bfd287ab561f&profile_id=175',
                      type: 'video/mp4'
                  }
              ]
          },
          {
              size : 960,
              source: [
                  {
                      url: 'https://player.vimeo.com/external/344108443.sd.mp4?s=c1730857e5c3097471ce4d0e05b3bfd287ab561f&profile_id=175',
                      type: 'video/mp4'
                  }
              ]
          },
          {
              size : 640,
              source: [
                  {
                      url: 'https://player.vimeo.com/external/344108443.hd.mp4?s=c1730857e5c3097471ce4d0e05b3bfd287ab561f&profile_id=175',
                      type: 'video/mp4'
                  }
              ]
          }
      ]
  }) }}

    <div class="o-container">
        {% call modal({
            id:'modal-subsc',
            noClose: false
        }, js-hook-modal) %}
        <h3>Niks willen missen van onze nieuwtjes en acties?</h3>
        {%call form.form() %}

        {{ form.input({
                type: 'email',
                class: 'input__email',
                name:'input-email',
                id: 'email',
                placeholder: 'Emailaddress'
            })}}

        <div class="name-input-container">
            {{ form.input({
                    type: 'text',
                    name:'input-first',
                    class: 'input__first hidden',
                    id: 'first',
                    required: true,
                    error: 'Please provide First name'
                })}}

            {{ form.input({
                    type: 'text',
                    name:'input-last',
                    class: 'input__last hidden',
                    id: 'last',
                    placeholder: 'Last name'
                })}}
        </div>

        {% endcall %}
        <!-- /form -->

        {{ button( {
                class: 'modal__button-back hidden',
                icon: 'chevron-left',
                label: 'back',
                variant: 'ghost'
            } ) }}

        {{ button( {
                class: 'modal__button-submit hidden',
                label: 'submit',
                variant: 'primary',
                icon: 'chevron-right',
                url: '#'
            } ) }}

        </form>

        {% endcall %}

        {{toast( {
            class: 'toast__bedankt',
            variant: 'success',
            label: 'Bedankt voor uw aanmelding!'
        })}}

        {{ button( {
      class: 'hero__cta',
      label: 'Subscribe to newsletter',
      url: '#',
      variant: 'secondary',
      icon: 'chevron-right',
      hook: 'modal__button-close',
      controls: 'modal-subsc'
    } ) }}
    </div>
</div>

<script>
    const modal = document.querySelector('#modal-subsc')
    const openButton = document.querySelector('.hero__cta')
    const videoDiv = document.querySelector('.video__player')
    const closeButton = document.querySelector('.modal__button-close')
    const emailInput = document.querySelector('#email')
    const firstNameInput = document.querySelector('.input__first')
    const lastNameInput = document.querySelector('.input__last')

    //open modal with button 'open modal'
    openButton.addEventListener('click', openModal)
    function openModal() {
        console.log('I am clicked')
        modal.classList.toggle('modal--is-showing')
        modal.classList.add('modal-subsc')

        //pause the video
        videoDiv.firstChild.pause()

        //show the close button
        closeButton.style.visibility = 'visible'

        //style the close button
        closeButton.classList.add('modal__button-round')

        //hide the subscribe button
        openButton.classList.add('hidden')
    }

    //close modal with x button
    closeButton.addEventListener('click', closeModal)
    closeButton.addEventListener('keypress', closeModal)
    function closeModal() {
        console.log('Closing the modal')
        modal.classList.toggle('modal--is-showing')

        //resume the video
        videoDiv.firstChild.play()

        //show the subscribe button
        openButton.classList.remove('hidden')
    }

    emailInput.addEventListener('click', showHiddenForm)
    function showHiddenForm() {
        console.log('email clicked!')
        firstNameInput.classList.remove('hidden')
        lastNameInput.classList.remove('hidden')
        document.querySelector('.modal__button-back').classList.remove('hidden')
        document.querySelector('.modal__button-submit').classList.remove('hidden')
    }

    //Form validation
    const submitButton = document.querySelector('.modal__button-submit')

    submitButton.addEventListener('click', validate)
    function validate() {
        firstInput = document.querySelector('#first')
        lastInput = document.querySelector('#last')
    if (emailInput.value == "") {
        alert("Please provide your Email!")
        emailInput.focus()
        return false
    } if (firstInput.value == "") {
        alert("Please provide your First name!")
        firstInput.focus()
        return false
    } if (lastInput.value == "") {
        alert("Please provide your Last name!")
        lastInput.focus()
        return false
    }
    validateEmail()
    }

    function validateEmail() {
        const emailValue = emailInput.value
        atPosition = emailValue.indexOf("@")
        dotPosition = emailValue.lastIndexOf(".")

        if (atPosition < 1 || (dotPosition - atPosition < 2) || dotPosition == emailValue.length-1 ) {
            alert("Please enter a valid e-mail address")
            emailInput.focus()
            return false
        }
        return true
    }
</script>